<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‰“ç –å—æ¸¸æˆ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: Arial, sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none; /* é˜²æ­¢è§¦æ‘¸æ—¶çš„é»˜è®¤è¡Œä¸º */
        }

        h1 {
            margin: 5px 0;
            font-size: 1.3em;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .game-container {
            position: relative;
            width: 90vw;
            height: calc(90vh - 40px); /* å‡å»æ ‡é¢˜é«˜åº¦ */
            max-width: 800px;
            max-height: 600px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            overflow: hidden;
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0a0a1a;
        }
        
        .game-info {
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
            flex-wrap: wrap;
        }

        .info-item {
            background: rgba(0, 0, 0, 0.7);
            padding: 4px 8px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: bold;
            margin: 2px;
        }

        .coins {
            color: #ffd700;
        }

        .level {
            color: #00ff00;
        }

        .score {
            color: #00ffff;
        }

        .lives {
            color: #ff69b4;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 20;
            display: none;
            max-width: 90%;
        }
        
        .game-over h2 {
            margin: 0 0 15px 0;
            color: #ff0000;
            font-size: 1.5em;
        }
        
        .game-over p {
            margin: 8px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: black;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 8px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.7);
        }
        
        .shop {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 20;
            display: none;
            max-width: 90%;
        }
        
        .shop h2 {
            margin: 0 0 15px 0;
            color: #00ff00;
            font-size: 1.5em;
        }
        
        .shop-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 8px 0;
            text-align: left;
        }
        
        .shop-item h3 {
            margin: 0 0 4px 0;
            color: #00ffff;
            font-size: 1em;
        }
        
        .shop-item p {
            margin: 0 0 8px 0;
            font-size: 12px;
        }
        
        .shop-item .price {
            color: #ffd700;
            font-weight: bold;
        }
        
        .shop-item .btn {
            float: right;
            padding: 4px 8px;
            font-size: 12px;
        }

        .pause-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 20;
            display: none;
        }

        .pause-screen h2 {
            margin: 0 0 15px 0;
            color: #ffff00;
            font-size: 1.5em;
        }

        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 255, 0, 0.9);
            color: black;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 30;
            display: none;
            animation: fadeOut 2s forwards;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        .power-up {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .power-up.speed {
            background: #ff0000;
            color: white;
        }
        
        .power-up.size {
            background: #00ff00;
            color: black;
        }
        
        .power-up.multi {
            background: #0000ff;
            color: white;
        }
        
        .coin {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            h1 {
                font-size: 1em;
                margin: 3px 0;
            }

            .game-container {
                width: 95vw;
                height: calc(95vh - 30px);
            }

            .info-item {
                font-size: 10px;
                padding: 2px 4px;
            }

            .btn {
                font-size: 10px;
                padding: 4px 8px;
                margin: 2px;
            }

            .game-over h2,
            .shop h2,
            .pause-screen h2 {
                font-size: 1em;
            }

            .game-over p,
            .pause-screen p {
                font-size: 12px;
            }

            .shop-item {
                padding: 8px;
                margin: 5px 0;
            }

            .shop-item h3 {
                font-size: 0.85em;
            }

            .shop-item p {
                font-size: 10px;
            }
        }

        @media (max-height: 600px) {
            h1 {
                font-size: 1em;
                margin: 2px 0;
            }

            .game-container {
                height: calc(95vh - 25px);
            }

            .info-item {
                font-size: 10px;
                padding: 2px 4px;
            }
        }
    </style>
</head>
<body>
    <h1>æ‰“ç –å—æ¸¸æˆ</h1>
    
    <div class="game-container">
        <div class="game-info">
            <div class="info-item lives">â¤ï¸ ç”Ÿå‘½: <span id="lives">3</span></div>
            <div class="info-item coins">ğŸ’° é‡‘å¸: <span id="coins">0</span></div>
            <div class="info-item level">ğŸ† ç­‰çº§: <span id="level">1</span></div>
            <div class="info-item score">ğŸ® åˆ†æ•°: <span id="score">0</span></div>
            <button class="btn" onclick="togglePause()">æš‚åœ</button>
            <button class="btn" onclick="openShop()">å•†åº—</button>
        </div>
        
        <canvas id="gameCanvas"></canvas>
        
        <div class="game-over" id="gameOver">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p>æœ€ç»ˆåˆ†æ•°: <span id="finalScore">0</span></p>
            <p>æœ€ç»ˆç­‰çº§: <span id="finalLevel">1</span></p>
            <button class="btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        </div>
        
        <div class="shop" id="shop">
            <h2>å•†åº—</h2>
            <div class="shop-item">
                <h3>ğŸ¯ Paddle é•¿åº¦ +20%</h3>
                <p>å¢åŠ  paddle çš„é•¿åº¦ï¼Œæ›´å®¹æ˜“æ¥ä½çƒ</p>
                <span class="price">ğŸ’° 50</span>
                <button class="btn" onclick="buyUpgrade('paddleSize')">è´­ä¹°</button>
            </div>
            <div class="shop-item">
                <h3>âš¡ çƒé€Ÿ +10%</h3>
                <p>å¢åŠ çƒçš„é€Ÿåº¦ï¼Œæ›´å¿«æ¸…é™¤ç –å—</p>
                <span class="price">ğŸ’° 75</span>
                <button class="btn" onclick="buyUpgrade('ballSpeed')">è´­ä¹°</button>
            </div>
            <div class="shop-item">
                <h3>ğŸ± å¤šçƒæ¨¡å¼</h3>
                <p>åŒæ—¶å‘å°„å¤šä¸ªçƒ</p>
                <span class="price">ğŸ’° 150</span>
                <button class="btn" onclick="buyUpgrade('multiBall')">è´­ä¹°</button>
            </div>
            <button class="btn" onclick="closeShop()">å…³é—­</button>
        </div>

        <div class="pause-screen" id="pauseScreen">
            <h2>æ¸¸æˆå·²æš‚åœ</h2>
            <p>æŒ‰æš‚åœæŒ‰é’®æˆ–ç©ºæ ¼é”®ç»§ç»­</p>
            <button class="btn" onclick="togglePause()">ç»§ç»­æ¸¸æˆ</button>
        </div>

        <div class="notification" id="notification"></div>
    </div>
    
    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            canvas: null,
            ctx: null,
            canvasWidth: 800,
            canvasHeight: 600,
            paddle: {
                x: 350,
                y: 550,
                width: 100,
                height: 15,
                speed: 8,
                color: '#00ffff'
            },
            balls: [
                {
                    x: 400,
                    y: 530,
                    radius: 8,
                    dx: 4,
                    dy: -4,
                    color: '#ffffff'
                }
            ],
            bricks: [],
            powerUps: [],
            coins: [],
            score: 0,
            coinsCollected: 0,
            level: 1,
            lives: 3,
            gameOver: false,
            paused: false,
            shopOpen: false,
            upgrades: {
                paddleSize: 1,
                ballSpeed: 1,
                multiBall: 1
            },
            brickRows: 5,
            brickCols: 10
        };
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            gameState.canvas = document.getElementById('gameCanvas');
            gameState.ctx = gameState.canvas.getContext('2d');
            
            // è®¾ç½®canvaså°ºå¯¸
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // åˆå§‹åŒ–ç –å—
            createBricks();
            
            // ç›‘å¬é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // ç›‘å¬é¼ æ ‡äº‹ä»¶
            gameState.canvas.addEventListener('mousemove', handleMouseMove);
            
            // ç›‘å¬è§¦æ‘¸äº‹ä»¶
            gameState.canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            gameState.canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            gameState.canvas.addEventListener('touchend', handleTouchEnd);
            
            // å¼€å§‹æ¸¸æˆå¾ªç¯
            gameLoop();
        }
        
        // è°ƒæ•´canvaså°ºå¯¸
        function resizeCanvas() {
            const container = gameState.canvas.parentElement;
            gameState.canvasWidth = container.clientWidth;
            gameState.canvasHeight = container.clientHeight;
            gameState.canvas.width = gameState.canvasWidth;
            gameState.canvas.height = gameState.canvasHeight;
            
            // è°ƒæ•´paddleä½ç½®
            gameState.paddle.y = gameState.canvasHeight - 30;
            gameState.paddle.x = (gameState.canvasWidth - gameState.paddle.width) / 2;
            
            // è°ƒæ•´çƒçš„ä½ç½®
            gameState.balls.forEach(ball => {
                ball.x = gameState.canvasWidth / 2;
                ball.y = gameState.paddle.y - 10;
            });
            
            // é‡æ–°åˆ›å»ºç –å—
            createBricks();
        }
        
        // åˆ›å»ºç –å—
        function createBricks() {
            gameState.bricks = [];
            const brickWidth = (gameState.canvasWidth - 40) / gameState.brickCols;
            const brickHeight = 20;
            const brickPadding = 8;
            const brickOffsetTop = 60;
            const brickOffsetLeft = 20;
            
            for (let r = 0; r < gameState.brickRows; r++) {
                for (let c = 0; c < gameState.brickCols; c++) {
                    gameState.bricks.push({
                        x: c * (brickWidth + brickPadding) + brickOffsetLeft,
                        y: r * (brickHeight + brickPadding) + brickOffsetTop,
                        width: brickWidth,
                        height: brickHeight,
                        status: 1,
                        color: getBrickColor(r)
                    });
                }
            }
        }
        
        // è·å–ç –å—é¢œè‰²
        function getBrickColor(row) {
            const colors = ['#ff0000', '#ff8000', '#ffff00', '#00ff00', '#00ffff'];
            return colors[row % colors.length];
        }
        
        // å¤„ç†é”®ç›˜æŒ‰ä¸‹
        function handleKeyDown(e) {
            if (e.key === 'Right' || e.key === 'ArrowRight') {
                gameState.paddle.movingRight = true;
            } else if (e.key === 'Left' || e.key === 'ArrowLeft') {
                gameState.paddle.movingLeft = true;
            } else if (e.key === ' ') {
                e.preventDefault();
                if (gameState.gameOver) {
                    restartGame();
                } else {
                    togglePause();
                }
            }
        }
        
        // å¤„ç†é”®ç›˜é‡Šæ”¾
        function handleKeyUp(e) {
            if (e.key === 'Right' || e.key === 'ArrowRight') {
                gameState.paddle.movingRight = false;
            } else if (e.key === 'Left' || e.key === 'ArrowLeft') {
                gameState.paddle.movingLeft = false;
            }
        }
        
        // å¤„ç†é¼ æ ‡ç§»åŠ¨
        function handleMouseMove(e) {
            const rect = gameState.canvas.getBoundingClientRect();
            const relativeX = e.clientX - rect.left;
            if (relativeX > 0 && relativeX < gameState.canvasWidth) {
                gameState.paddle.x = relativeX - (gameState.paddle.width * gameState.upgrades.paddleSize) / 2;
            }
        }
        
        // å¤„ç†è§¦æ‘¸å¼€å§‹
        function handleTouchStart(e) {
            e.preventDefault();
            handleTouch(e);
        }
        
        // å¤„ç†è§¦æ‘¸ç§»åŠ¨
        function handleTouchMove(e) {
            e.preventDefault();
            handleTouch(e);
        }
        
        // å¤„ç†è§¦æ‘¸ç»“æŸ
        function handleTouchEnd(e) {
            e.preventDefault();
        }
        
        // å¤„ç†è§¦æ‘¸äº‹ä»¶
        function handleTouch(e) {
            const rect = gameState.canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const relativeX = touch.clientX - rect.left;
            if (relativeX > 0 && relativeX < gameState.canvasWidth) {
                gameState.paddle.x = relativeX - (gameState.paddle.width * gameState.upgrades.paddleSize) / 2;
            }
        }
        
        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            if (gameState.gameOver || gameState.shopOpen || gameState.paused) {
                requestAnimationFrame(gameLoop);
                return;
            }
            
            // æ¸…ç©ºç”»å¸ƒ
            gameState.ctx.clearRect(0, 0, gameState.canvasWidth, gameState.canvasHeight);
            
            // ç»˜åˆ¶æ‰€æœ‰å…ƒç´ 
            drawPaddle();
            drawBalls();
            drawBricks();
            drawPowerUps();
            drawCoins();
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            updatePaddle();
            updateBalls();
            updatePowerUps();
            updateCoins();
            
            // æ£€æŸ¥æ¸¸æˆèƒœåˆ©
            checkWin();
            
            requestAnimationFrame(gameLoop);
        }
        
        // ç»˜åˆ¶ paddle
        function drawPaddle() {
            gameState.ctx.beginPath();
            gameState.ctx.rect(
                gameState.paddle.x,
                gameState.paddle.y,
                gameState.paddle.width * gameState.upgrades.paddleSize,
                gameState.paddle.height
            );
            gameState.ctx.fillStyle = gameState.paddle.color;
            gameState.ctx.fill();
            gameState.ctx.closePath();
        }
        
        // ç»˜åˆ¶çƒ
        function drawBalls() {
            gameState.balls.forEach(ball => {
                gameState.ctx.beginPath();
                gameState.ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                gameState.ctx.fillStyle = ball.color;
                gameState.ctx.fill();
                gameState.ctx.closePath();
            });
        }
        
        // ç»˜åˆ¶ç –å—
        function drawBricks() {
            gameState.bricks.forEach(brick => {
                if (brick.status === 1) {
                    gameState.ctx.beginPath();
                    gameState.ctx.rect(brick.x, brick.y, brick.width, brick.height);
                    gameState.ctx.fillStyle = brick.color;
                    gameState.ctx.fill();
                    gameState.ctx.closePath();
                }
            });
        }
        
        // ç»˜åˆ¶ power-up
        function drawPowerUps() {
            gameState.powerUps.forEach(powerUp => {
                gameState.ctx.beginPath();
                gameState.ctx.arc(powerUp.x, powerUp.y, 15, 0, Math.PI * 2);
                gameState.ctx.fillStyle = powerUp.color;
                gameState.ctx.fill();
                gameState.ctx.fillStyle = powerUp.textColor;
                gameState.ctx.font = '12px Arial';
                gameState.ctx.textAlign = 'center';
                gameState.ctx.textBaseline = 'middle';
                gameState.ctx.fillText(powerUp.displayText, powerUp.x, powerUp.y);
                gameState.ctx.closePath();
            });
        }
        
        // ç»˜åˆ¶é‡‘å¸
        function drawCoins() {
            gameState.coins.forEach(coin => {
                gameState.ctx.beginPath();
                gameState.ctx.arc(coin.x, coin.y, 10, 0, Math.PI * 2);
                gameState.ctx.fillStyle = '#ffd700';
                gameState.ctx.fill();
                gameState.ctx.closePath();
            });
        }
        
        // æ›´æ–° paddle
        function updatePaddle() {
            const paddleWidth = gameState.paddle.width * gameState.upgrades.paddleSize;
            if (gameState.paddle.movingRight && gameState.paddle.x < gameState.canvasWidth - paddleWidth) {
                gameState.paddle.x += gameState.paddle.speed;
            } else if (gameState.paddle.movingLeft && gameState.paddle.x > 0) {
                gameState.paddle.x -= gameState.paddle.speed;
            }
            // ç¡®ä¿paddleä¸ä¼šè¶…å‡ºè¾¹ç•Œ
            if (gameState.paddle.x < 0) {
                gameState.paddle.x = 0;
            }
            if (gameState.paddle.x > gameState.canvasWidth - paddleWidth) {
                gameState.paddle.x = gameState.canvasWidth - paddleWidth;
            }
        }
        
        // æ›´æ–°çƒ
        function updateBalls() {
            gameState.balls.forEach((ball, index) => {
                // ç¢°æ’æ£€æµ‹ - å·¦å³å¢™å£
                if (ball.x + ball.dx > gameState.canvasWidth - ball.radius || ball.x + ball.dx < ball.radius) {
                    ball.dx = -ball.dx;
                }
                
                // ç¢°æ’æ£€æµ‹ - ä¸Šå¢™å£
                if (ball.y + ball.dy < ball.radius) {
                    ball.dy = -ball.dy;
                }
                
                // ç¢°æ’æ£€æµ‹ - paddle
                if (ball.y + ball.dy > gameState.paddle.y - ball.radius && 
                    ball.y + ball.dy < gameState.paddle.y + gameState.paddle.height && 
                    ball.x > gameState.paddle.x && 
                    ball.x < gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize)) {
                    // è®¡ç®—ç¢°æ’ç‚¹ï¼Œä½¿çƒçš„åå¼¹è§’åº¦ä¸ç¢°æ’ä½ç½®æœ‰å…³
                    const hitPos = (ball.x - (gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize) / 2)) / 
                                   ((gameState.paddle.width * gameState.upgrades.paddleSize) / 2);
                    const angle = hitPos * Math.PI / 3; // æœ€å¤§60åº¦è§’
                    ball.dx = gameState.upgrades.ballSpeed * 4 * Math.sin(angle);
                    ball.dy = -gameState.upgrades.ballSpeed * 4 * Math.cos(angle);
                }
                
                // ç¢°æ’æ£€æµ‹ - ç –å—
                gameState.bricks.forEach(brick => {
                    if (brick.status === 1) {
                        // æ”¹è¿›çš„ç¢°æ’æ£€æµ‹
                        const ballLeft = ball.x - ball.radius;
                        const ballRight = ball.x + ball.radius;
                        const ballTop = ball.y - ball.radius;
                        const ballBottom = ball.y + ball.radius;

                        if (ballRight > brick.x &&
                            ballLeft < brick.x + brick.width &&
                            ballBottom > brick.y &&
                            ballTop < brick.y + brick.height) {

                            // ç¡®å®šç¢°æ’æ–¹å‘
                            const overlapLeft = ballRight - brick.x;
                            const overlapRight = (brick.x + brick.width) - ballLeft;
                            const overlapTop = ballBottom - brick.y;
                            const overlapBottom = (brick.y + brick.height) - ballTop;

                            const minOverlap = Math.min(overlapLeft, overlapRight, overlapTop, overlapBottom);

                            if (minOverlap === overlapTop || minOverlap === overlapBottom) {
                                ball.dy = -ball.dy;
                            } else {
                                ball.dx = -ball.dx;
                            }

                            brick.status = 0;
                            gameState.score += 10;
                            updateScore();

                            // éšæœºç”Ÿæˆ power-up
                            if (Math.random() > 0.8) {
                                createPowerUp(brick.x + brick.width / 2, brick.y + brick.height / 2);
                            }

                            // éšæœºç”Ÿæˆé‡‘å¸ - æ¦‚ç‡æå‡5å€ï¼ˆä»40%æå‡åˆ°92%ï¼‰
                            if (Math.random() > 0.08) {
                                createCoin(brick.x + brick.width / 2, brick.y + brick.height / 2);
                            }
                        }
                    }
                });
                
                // çƒå‡ºç•Œ
                if (ball.y + ball.dy > gameState.canvasHeight - ball.radius) {
                    gameState.balls.splice(index, 1);
                    if (gameState.balls.length === 0) {
                        gameState.lives--;
                        updateLives();
                        if (gameState.lives <= 0) {
                            endGame();
                        } else {
                            showNotification('å¤±å»ä¸€æ¡ç”Ÿå‘½!');
                            resetBall();
                        }
                    }
                }
                
                // æ›´æ–°çƒä½ç½®
                ball.x += ball.dx;
                ball.y += ball.dy;
            });
        }
        
        // æ›´æ–° power-up
        function updatePowerUps() {
            gameState.powerUps.forEach((powerUp, index) => {
                powerUp.y += 2;
                
                // ç¢°æ’æ£€æµ‹ - paddle
                if (powerUp.y + 15 > gameState.paddle.y && 
                    powerUp.y - 15 < gameState.paddle.y + gameState.paddle.height && 
                    powerUp.x > gameState.paddle.x && 
                    powerUp.x < gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize)) {
                    applyPowerUp(powerUp.type);
                    gameState.powerUps.splice(index, 1);
                }
                
                // å‡ºç•Œ
                if (powerUp.y > gameState.canvasHeight) {
                    gameState.powerUps.splice(index, 1);
                }
            });
        }
        
        // æ›´æ–°é‡‘å¸
        function updateCoins() {
            gameState.coins.forEach((coin, index) => {
                coin.y += 1.5;
                
                // ç¢°æ’æ£€æµ‹ - paddle
                if (coin.y + 10 > gameState.paddle.y && 
                    coin.y - 10 < gameState.paddle.y + gameState.paddle.height && 
                    coin.x > gameState.paddle.x && 
                    coin.x < gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize)) {
                    gameState.coinsCollected += 1;
                    updateCoinsDisplay();
                    gameState.coins.splice(index, 1);
                }
                
                // å‡ºç•Œ
                if (coin.y > gameState.canvasHeight) {
                    gameState.coins.splice(index, 1);
                }
            });
        }
        
        // åˆ›å»º power-up
        function createPowerUp(x, y) {
            const types = ['speed', 'size', 'multi'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            let color, textColor, displayText;
            switch (type) {
                case 'speed':
                    color = '#ff0000';
                    textColor = '#ffffff';
                    displayText = 'S';
                    break;
                case 'size':
                    color = '#00ff00';
                    textColor = '#000000';
                    displayText = 'P';
                    break;
                case 'multi':
                    color = '#0000ff';
                    textColor = '#ffffff';
                    displayText = 'M';
                    break;
            }
            
            gameState.powerUps.push({
                x: x,
                y: y,
                type: type,
                color: color,
                textColor: textColor,
                displayText: displayText
            });
        }
        
        // åˆ›å»ºé‡‘å¸
        function createCoin(x, y) {
            gameState.coins.push({
                x: x,
                y: y
            });
        }
        
        // åº”ç”¨ power-up
        function applyPowerUp(type) {
            switch (type) {
                case 'speed':
                    gameState.balls.forEach(ball => {
                        ball.dx *= 1.2;
                        ball.dy *= 1.2;
                    });
                    break;
                case 'size':
                    if (gameState.upgrades.paddleSize < 1.5) {
                        gameState.upgrades.paddleSize += 0.2;
                    }
                    break;
                case 'multi':
                    // æ·»åŠ é¢å¤–çš„çƒ
                    for (let i = 0; i < 2; i++) {
                        gameState.balls.push({
                            x: gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize) / 2,
                            y: gameState.paddle.y - 10,
                            radius: 8,
                            dx: 4 * (Math.random() > 0.5 ? 1 : -1),
                            dy: -4,
                            color: '#ffffff'
                        });
                    }
                    break;
            }
        }
        
        // æ£€æŸ¥èƒœåˆ©
        function checkWin() {
            const remainingBricks = gameState.bricks.filter(brick => brick.status === 1).length;
            if (remainingBricks === 0) {
                // è¿›å…¥ä¸‹ä¸€å…³
                gameState.level++;
                gameState.brickRows = Math.min(8, gameState.brickRows + 1);
                gameState.brickCols = Math.min(12, gameState.brickCols + 1);
                createBricks();
                resetBall();
                updateLevel();
                showNotification(`æ­å–œ!è¿›å…¥ç¬¬ ${gameState.level} å…³!`);
            }
        }
        
        // é‡ç½®çƒ
        function resetBall() {
            gameState.balls = [{
                x: gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize) / 2,
                y: gameState.paddle.y - 10,
                radius: 8,
                dx: 4 * gameState.upgrades.ballSpeed,
                dy: -4 * gameState.upgrades.ballSpeed,
                color: '#ffffff'
            }];
        }
        
        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.gameOver = true;
            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('finalLevel').textContent = gameState.level;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            gameState.score = 0;
            gameState.coinsCollected = 0;
            gameState.level = 1;
            gameState.lives = 3;
            gameState.gameOver = false;
            gameState.paused = false;
            gameState.brickRows = 5;
            gameState.brickCols = 10;
            gameState.upgrades = {
                paddleSize: 1,
                ballSpeed: 1,
                multiBall: 1
            };

            updateScore();
            updateCoinsDisplay();
            updateLevel();
            updateLives();

            createBricks();
            resetBall();

            document.getElementById('gameOver').style.display = 'none';
        }
        
        // æ‰“å¼€å•†åº—
        function openShop() {
            gameState.shopOpen = true;
            document.getElementById('shop').style.display = 'block';
        }
        
        // å…³é—­å•†åº—
        function closeShop() {
            gameState.shopOpen = false;
            document.getElementById('shop').style.display = 'none';
        }
        
        // è´­ä¹°å‡çº§
        function buyUpgrade(type) {
            let price, success = false, message = '';
            switch (type) {
                case 'paddleSize':
                    price = 50;
                    if (gameState.upgrades.paddleSize >= 1.5) {
                        message = 'Paddle é•¿åº¦å·²è¾¾åˆ°æœ€å¤§!';
                    } else if (gameState.coinsCollected < price) {
                        message = `é‡‘å¸ä¸è¶³! éœ€è¦ ${price} é‡‘å¸`;
                    } else {
                        gameState.coinsCollected -= price;
                        gameState.upgrades.paddleSize += 0.2;
                        updateCoinsDisplay();
                        success = true;
                        message = 'Paddle é•¿åº¦å·²å‡çº§!';
                    }
                    break;
                case 'ballSpeed':
                    price = 75;
                    if (gameState.upgrades.ballSpeed >= 1.5) {
                        message = 'çƒé€Ÿå·²è¾¾åˆ°æœ€å¤§!';
                    } else if (gameState.coinsCollected < price) {
                        message = `é‡‘å¸ä¸è¶³! éœ€è¦ ${price} é‡‘å¸`;
                    } else {
                        gameState.coinsCollected -= price;
                        gameState.upgrades.ballSpeed += 0.2;
                        gameState.balls.forEach(ball => {
                            ball.dx *= 1.2;
                            ball.dy *= 1.2;
                        });
                        updateCoinsDisplay();
                        success = true;
                        message = 'çƒé€Ÿå·²å‡çº§!';
                    }
                    break;
                case 'multiBall':
                    price = 150;
                    if (gameState.upgrades.multiBall >= 3) {
                        message = 'å¤šçƒæ¨¡å¼å·²è¾¾åˆ°æœ€å¤§!';
                    } else if (gameState.coinsCollected < price) {
                        message = `é‡‘å¸ä¸è¶³! éœ€è¦ ${price} é‡‘å¸`;
                    } else {
                        gameState.coinsCollected -= price;
                        gameState.upgrades.multiBall++;
                        // æ·»åŠ é¢å¤–çš„çƒ
                        for (let i = 0; i < gameState.upgrades.multiBall - 1; i++) {
                            gameState.balls.push({
                                x: gameState.paddle.x + (gameState.paddle.width * gameState.upgrades.paddleSize) / 2,
                                y: gameState.paddle.y - 10,
                                radius: 8,
                                dx: 4 * (Math.random() > 0.5 ? 1 : -1),
                                dy: -4,
                                color: '#ffffff'
                            });
                        }
                        updateCoinsDisplay();
                        success = true;
                        message = 'å¤šçƒæ¨¡å¼å·²å‡çº§!';
                    }
                    break;
            }
            showNotification(message, success);
        }
        
        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            document.getElementById('score').textContent = gameState.score;
        }
        
        // æ›´æ–°é‡‘å¸æ˜¾ç¤º
        function updateCoinsDisplay() {
            document.getElementById('coins').textContent = gameState.coinsCollected;
        }
        
        // æ›´æ–°ç­‰çº§æ˜¾ç¤º
        function updateLevel() {
            document.getElementById('level').textContent = gameState.level;
        }

        // æ›´æ–°ç”Ÿå‘½å€¼æ˜¾ç¤º
        function updateLives() {
            document.getElementById('lives').textContent = gameState.lives;
        }

        // åˆ‡æ¢æš‚åœçŠ¶æ€
        function togglePause() {
            if (gameState.gameOver) return;
            gameState.paused = !gameState.paused;
            if (gameState.paused) {
                document.getElementById('pauseScreen').style.display = 'block';
            } else {
                document.getElementById('pauseScreen').style.display = 'none';
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, isSuccess = true) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.background = isSuccess ? 'rgba(0, 255, 0, 0.9)' : 'rgba(255, 0, 0, 0.9)';
            notification.style.color = isSuccess ? 'black' : 'white';
            notification.style.display = 'block';

            // é‡ç½®åŠ¨ç”»
            notification.style.animation = 'none';
            setTimeout(() => {
                notification.style.animation = 'fadeOut 2s forwards';
            }, 10);

            // 2ç§’åéšè—
            setTimeout(() => {
                notification.style.display = 'none';
            }, 2000);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = initGame;
    </script>
</body>
</html>
